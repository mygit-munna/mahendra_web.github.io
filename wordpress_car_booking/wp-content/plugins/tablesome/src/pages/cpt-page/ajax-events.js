import{get}from"svelte/store";import{notifications}from"./../../table/svelte/notification/notifications";var tableProps=require("./props"),ajaxEvents={alertMessage:"Table Created, Successfully",submitTable:function(e){const t=this;let o=this.getModifiedRecords(get(e.rows)),n=get(e.workflow),s=this.getTriggers(n.triggers);const i=parseInt(e.tableID),a={table_id:i,table_title:tableProps.getTitle(),columns:get(e.columns),last_column_id:get(e.lastColumnID),triggers:s,editorState:get(e.editorState),access_control:get(e.accessControl).fields,display:get(e.display),style:get(e.style),mode:get(e.mode),sort:{order:get(e.sortOrder),field:get(e.sortField),index:get(e.activeColumnIndex)}};let c={table_id:i,records_deleted:get(e.recordsDeleted),records_inserted:o.insertedRecords,records_updated:o.updatedRecords,columns_deleted:get(e.columnsDeleted),columns_duplicated:get(e.columnsDuplicated),mode:get(e.mode)};i>0&&(t.alertMessage="Table Updated, Successfully"),fetch(tablesome_ajax_object.api_endpoints.create_or_update_table,{method:"post",headers:{"Content-Type":"application/json","X-WP-Nonce":tablesome_ajax_object.rest_nonce},body:JSON.stringify(a)}).then((function(e){return e.json()})).then((function(e){return e})).then((function(e){"success"==e.status&&e.table_id>0&&(c.table_id=parseInt(e.table_id),t.sendRecords(c,a.mode))})).catch((function(e){}))},sendRecords:function(e,t="editor"){var o=this;fetch(tablesome_ajax_object.api_endpoints.prefix+e.table_id+"/records",{method:"post",headers:{"Content-Type":"application/json","X-WP-Nonce":tablesome_ajax_object.rest_nonce},body:JSON.stringify(e)}).then((function(n){notifications.success(o.alertMessage,"",5e3);let s=window.location.href;"editor"==t&&(s=new URL(tablesome_ajax_object.edit_table_url),s.searchParams.set("post",e.table_id)),window.location.replace(s)})).then((function(e){})).catch((function(e){}))},getModifiedRecords:function(e){let t=[],o=[];return e.map((function(e,n){0==e.record_id?t.push(e):o.push(e)})),{insertedRecords:t,updatedRecords:o}},getTriggers:function(e){return e.map((function(e){return e.actions&&e.actions.length>0&&(e.actions=e.actions.map((function(e){return e.match_columns&&e.match_columns.length>0&&(e.match_columns=e.match_columns.map((function(e){return{...e}}))),e.match_fields&&e.match_fields.length>0&&(e.match_fields=e.match_fields.map((function(e){return{...e}}))),e.conditions&&e.conditions.length>0&&(e.conditions=e.conditions.map((function(e){return{...e}}))),{...e}}))),{...e}}))}};export default ajaxEvents;